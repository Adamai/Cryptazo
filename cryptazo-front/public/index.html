<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>Cryptazo</title>
    <script language="javascript" type="text/javascript" src="web3.min.js"></script>
    <!-- criar o arquivo cryptazo_abi.js que é um JSON para passar como variável cryptoTazoABI na função startApp() -->
    <script language="javascript" type="text/javascript" src="cryptazo_abi.js"></script>
  </head>
  <body>
      <!-- onde serão impressas as informações do tazo??? -->
      <div id="txStatus"></div>
      <div id="tazos"></div>
      
    <script>
      
      window.addEventListener('load', function() {
        var crypTazo;

        var userAccount;

        function startApp() {
          var cryptoTazoAddress = "0xA514F21Ec1e8d5Dc213790F72Fc3897E0bCebD5e";
          // Passar cryptoTazoABI como variável
          crypTazo = new web3js.eth.Contract(cryptoTazoABI, cryptoTazoAddress);

          var accountInterval = setInterval(function() {
          
          if (web3.eth.accounts[0] !== userAccount) {
            userAccount = web3.eth.accounts[0];
            
            getTazosByOwner(userAccount)
            .then(displayTazos);
          }
        }, 100);

       
        function displayTazos(ids) {
        // Implementar essa função
      }

      function createRandomTazo(name) {
        
        
        $("#txStatus").text("Creating new tazo on the blockchain. This may take a while...");
        
        return crypTazo.methods.createRandomTazo(name)
        .send({ from: userAccount })
        .on("receipt", function(receipt) {
          $("#txStatus").text("Successfully created " + name + "!");
          
          getTazosByOwner(userAccount).then(displayTazos);
        })
        .on("error", function(error) {
          
          $("#txStatus").text(error);
        });
      }

      function levelUp(tazoId) {
        $("#txStatus").text("Leveling up your tazo...");
        return crypTazo.methods.levelUp(tazoId)
        .send({ from: userAccount, value: web3js.utils.toWei("0.001", "ether") })
        .on("receipt", function(receipt) {
          $("#txStatus").text("Power overwhelming! Tazo successfully leveled up");
        })
        .on("error", function(error) {
          $("#txStatus").text(error);
        });
      }

        function getTazoDetails(id) {
         return cryptoTazo.methods.tazos(id).call()
      }

        function tazoToOwner(id) {
          return crypTazo.methods.tazoToOwner(id).call()
        }

        function getTazosByOwner(owner) {
          return crypTazo.methods.getTazosByOwner(owner).call()
        }

        // Verificando se o Web3 foi injetado pelo navegador (Mist / MetaMask)
        if (typeof web3 !== 'undefined') {
          // Use Mist/MetaMask's provider
          web3js = new Web3(web3.currentProvider);
        } else {
          // Lidar com o caso em que o usuário não tem web3. Provavelmente
          // mostre a eles uma mensagem dizendo-lhes para instalar o Metamask
          // a fim de usar nosso aplicativo.
        }

        // Agora você pode iniciar seu aplicativo e acessar o web3js livremente:
        startApp()

      })
    </script>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
</html>
